<!doctype html>
<html lang="en">
<style>
    .bg-color {
        background-color: #ece9e9;
        color: black;
    }

    .color-01 {
        background-color: #d5d8d8;
        color: black;
    }

    .color-02 {
        background-color: #453b3a;
        color: white;
    }

    .color-03 {
        background-color: #a47b5e;
        color: white;
    }

    .preline {
        white-space:
            pre-line;
    }

    #timeline {
        list-style: none;
        position: relative;
    }


    #timeline:before {
        top: 0;
        bottom: 0;
        position: absolute;
        content: " ";
        width: 2px;
        background-color: #4997cd;
        left: 50%;
        margin-left: -1.5px;
    }

    #timeline .clearFix {
        clear: both;
        height: 0;
    }

    #timeline .timeline-badge {
        color: #fff;
        width: 50px;
        height: 50px;
        font-size: 1em;
        text-align: center;
        position: absolute;
        top: 60px;
        left: 50%;
        margin-left: -25px;
        background-color: #4997cd;
        z-index: 100;
        border-top-right-radius: 50%;
        border-top-left-radius: 50%;
        border-bottom-right-radius: 50%;
        border-bottom-left-radius: 50%;
    }

    #timeline .timeline-badge span.timeline-balloon-date-day {
        font-size: 1.4em;
    }

    #timeline .timeline-badge span.timeline-balloon-date-month {
        font-size: .7em;
        position: relative;
        top: -10px;
    }

    #timeline .timeline-badge.timeline-filter-movement {
        background-color: #ece9e9;
        font-size: 1.7em;
        height: 35px;
        margin-left: -18px;
        width: 35px;
        top: 35px;
    }

    #timeline .timeline-badge.timeline-filter-movement a span {
        color: #4997cd;
        font-size: 1.3em;
        top: -1px;
    }

    #timeline .timeline-badge.timeline-future-movement {
        background-color: #ece9e9;
        height: 35px;
        width: 35px;
        font-size: 1.7em;
        top: -16px;
        margin-left: -18px;
    }

    #timeline .timeline-badge.timeline-future-movement a span {
        color: #4997cd;
        font-size: .9em;
        top: 2px;
        left: 1px;
    }

    #timeline .timeline-movement {
        border-bottom: dashed 1px #4997cd;
        position: relative;
    }

    #timeline .timeline-movement.timeline-movement-top {
        height: 60px;
    }

    #timeline .timeline-movement .timeline-item {
        padding: 0px 0px 10px 40px;
    }

    #timeline .timeline-movement .timeline-item .timeline-panel {
        border: 1px solid #d4d4d4;
        border-radius: 3px;
        background-color: #FFFFFF;
        color: #666;
        padding: 5px 5px 5px 5px;
        position: relative;
        -webkit-box-shadow: 0 1px 6px rgba(0, 0, 0, 0.175);
        box-shadow: 0 1px 6px rgba(0, 0, 0, 0.175);

    }



    #timeline .timeline-movement .timeline-item .timeline-panel .timeline-panel-ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    #timeline .timeline-movement .timeline-item .timeline-panel.credits .timeline-panel-ul {
        text-align: right;
    }

    #timeline .timeline-movement .timeline-item .timeline-panel.credits .timeline-panel-ul li {
        color: #666;
    }

    #timeline .timeline-movement .timeline-item .timeline-panel.credits .timeline-panel-ul li span.importo {
        color: #468c1f;
        font-size: 1.3em;
    }

    #timeline .timeline-movement .timeline-item .timeline-panel.debits .timeline-panel-ul {
        text-align: left;

    }

    #timeline .timeline-movement .timeline-item .timeline-panel.debits .timeline-panel-ul span.importo {
        color: #e2001a;
        font-size: 1.3em;
    }
</style>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- development version, includes helpful console warnings -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <title>Hello, world!</title>
</head>


<body class="bg-color" id="body">
    <div class="container-lg">
        <div class="row">
            <div class="col color-02">
                * 總共聊天天數 - 由什麼時候開始<br>
                * 總共傳了多少訊息 - BOT 及非BOT
            </div>
            <div class="col color-01">
                <canvas id="myChart" width="100" height="80"></canvas>
                群友的頭六名的訊息數(不包括BOT) (棒型圖)
            </div>
            <div class="col color-03">
                * 每日平均訊息數量
                * 最多說話的一天
            </div>
        </div>

    </div>
    <div class="container-lg">
        <div class="row">
            <div class="col color-02">
                <canvas id="myChart2" width="100" height="80"></canvas>
                群友各自占聊天的比例 (圓型圖)

            </div>
            <div class="col color-01">
                最常講的字 (文字雲)
            </div>
            <div class="col color-03">
                <canvas id="myChart2" width="100" height="80"></canvas>
                * 6. 每日訊息數(拆線圖)
            </div>
        </div>

    </div>





    <div class="container" id="Body">
        <div class="page-header">
            <center>
                <h1>聊天紀錄</h1>
            </center>
        </div>
        <div id="timeline">
            <div class="row timeline-movement timeline-movement-top">
                <div class="timeline-badge timeline-future-movement">
                    <a href="#">
                        <i class="fa fa-plus" aria-hidden="true"></i>
                    </a>
                </div>
                <div class="timeline-badge timeline-filter-movement">
                    <a href="#">
                        <i class="fa fa-clock-o" aria-hidden="true"></i>
                    </a>
                </div>

            </div>
            <!--START-->

            <div class="row timeline-movement" v-for="(message,index) in messages">
                <div class="timeline-badge" v-if="message.month">
                    <span class="timeline-balloon-date-day">{{message.day}}</span>
                    <span class="timeline-balloon-date-month">{{message.month}}</span>

                </div>


                <div class="col-sm-6  timeline-item">
                    <div class="row">
                        <div class="col-sm-11">
                            <div class="timeline-panel credits">
                                <ul class="timeline-panel-ul">
                                    <li><span class="importo">{{message.user}}</span></li>
                                    <li><span class="causale preline">{{message.contact}}
                                        </span> </li>
                                    <li>
                                        <p><small class="text-muted"><i class="glyphicon glyphicon-time"></i>
                                                {{message.date}}</small></p>
                                    </li>
                                </ul>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="col-sm-6  timeline-item" v-if="messages2[index]">
                    <div class="row">
                        <div class="col-sm-offset-1 col-sm-11">
                            <div class="timeline-panel debits">
                                <ul class="timeline-panel-ul">
                                    <li><span class="importo">{{messages2[index].user}}</span></li>
                                    <li><span class="causale preline">{{messages2[index].contact}}
                                        </span> </li>
                                    <li>
                                        <p><small class="text-muted"><i class="glyphicon glyphicon-time"></i>
                                                {{messages2[index].date}}</small></p>
                                    </li>
                                </ul>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <!--END-->

        </div>
    </div>
    </div>

    <div class="container-lg fixed-bottom">
        <div class="progress" id="touchBar" style="height: 30px; background: #ccc;">
            <div class="progress-bar" id="progressbar" role="progressbar" style="width: 10%" aria-valuenow="25"
                aria-valuemin="0" aria-valuemax="100">25%</div>
        </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script>
        //https://getbootstrap.com/docs/4.5/components/scrollspy/#list-item-4
        // Object.keys(list);
        /**
         * 1. 
         * 總共聊天天數 - 由什麼時候開始
         * 總共傳了多少訊息 - BOT 及非BOT
         * 
         * 2.
         * 群友的頭六名的訊息數(不包括BOT) (棒型圖)
         * 
         * 3.
         * 每日平均訊息數量
         * 最多說話的一天
         * 
         * 4.群友各自占聊天的比例 (圓型圖)  
         * 
         * 5. 
         * 最常講的字 (文字雲) 
         * 
         * 6. 每日訊息數(拆線圖)
         * 
         */

        var rawData = [{
            TIMESTRAMP: 00000000,
            contact: '',
            userName: '',
            isbot: false,
        }]
        //總共聊天天數 - 由什麼時候開始
        var totallydate = totallyDay(rawData);
        //[d, '天', pad(h), '小時', pad(m), '分鐘'].join('');

        //總共傳了多少訊息 - BOT 及非BOT
        var totallymessage = analysicTotallymessage(rawData);
        //[humanTimes.length, botTimes.length

        //最多訊息數日子頭三，訊息數 O   
        var date = analysicDate(rawData)


        // 群友的頭六名的訊息數(不包括BOT) (棒型圖)
        var peopleTalk = analysicPeopleTalk(rawData);


        //群友各自占聊天的比例   
        var peoplePer = analysicPeoplePer(peopleTalk);

        //每日平均訊息數量
        //totallymessage/totallydate

        //最多說話的一天 

        //https://github.com/pulipulichen/HTML5-Text-Analyzer
        //最常講的字 文字雲(大於30次才會顯示)   

        /**
         *    contact: 'Third: Learn JavaScript\nWWW',
                        TIMESTRAMP: '2009-09-09',
                        user: 'Sad',
                        ISBOT?: "Dec.",
                        
         * 
         * */


        function analysicPeoplePer(rawData) {

        }

        //最多訊息數日子頭三， 訊息數 O
        async function analysicDate(result) {
            let tempresult = [];
            let temptime = 0;
            for (let index = 1; index < result.length; index++) {
                let unix_timestamp = result[index].TIMESTRAMP;
                // console.log(temp)
                let data = new Date(unix_timestamp * 1000);
                if (!tempresult || !tempresult[temptime]) {
                    tempresult[temptime] = {
                        data: data,
                        number: 1
                    };
                } else if (tempresult[temptime].data.toISOString() == data.toISOString()) {
                    tempresult[temptime].number++
                } else {
                    temptime++
                    tempresult[temptime] = {
                        data: data,
                        number: 1
                    };
                }

            }
            return tempresult
        }

        //群友的頭六名的訊息數(不包括BOT) (棒型圖)
        function analysicPeopleTalk(messages) {
            var tempData = [];
            messages.forEach(message => {
                if (!tempData[message.user]) {
                    tempData[message.user] = 1;
                } else tempData[message.user]++;
            })
            return tempData;
        }

        function analysicTotallymessage(messages) {
            let humanTimes = messages.filter(time => time.isbot == false) || [];
            let botTimes = messages.filter(time => time.length == true) || [];
            return [humanTimes.length, botTimes.length]
        }

        function totallyDay(result) {
            if (!result) return;
            let firstDay = result[result.length - 1];
            let Day = firstDay.TIMESTRAMP;
            let today = new Date().getTime();
            //console.log(result[1])
            return dhm(today - Day);
            //"[30/10/2019, 17:07:04]", "30", "10", "2019", "17", "07", "04"]
        }

        function dhm(t) {
            var cd = 24 * 60 * 60 * 1000,
                ch = 60 * 60 * 1000,
                d = Math.floor(t / cd),
                h = Math.floor((t - d * cd) / ch),
                m = Math.round((t - d * cd - h * ch) / 60000),
                pad = function (n) {
                    return n < 10 ? '0' + n : n;
                };
            if (m === 60) {
                h++;
                m = 0;
            }
            if (h === 24) {
                d++;
                h = 0;
            }
            return [d, '天', pad(h), '小時', pad(m), '分鐘'].join('');
        }
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.js"
        integrity="sha512-QEiC894KVkN9Tsoi6+mKf8HaCLJvyA6QIRzY5KrfINXYuP9NxdIkRQhGq3BZi0J4I7V5SidGM3XUQ5wFiMDuWg=="
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.css"
        integrity="sha512-SUJFImtiT87gVCOXl3aGC00zfDl6ggYAw5+oheJvRJ8KBXZrr/TMISSdVJ5bBarbQDRC2pR5Kto3xTR0kpZInA=="
        crossorigin="anonymous" />

    <script>
        var ctx = document.getElementById("myChart").getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
                datasets: [{
                    label: '# of Votes',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });
        var app4 = new Vue({
            el: '#Body',
            data: {
                messages: [{
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }, {
                    contact: 'first',
                    date: '2009-09-09',
                    user: 'Sad',
                    month: "Dec.",
                    day: "05"
                }],
                messages2: [{
                        contact: 'Second, Learn JavaScript',
                        date: '2009-09-09',
                        user: 'Sad',
                        month: "Dec.",
                        day: "05"
                    },
                    {
                        contact: 'Third: Learn JavaScript\nWWW',
                        date: '2009-09-09',
                        user: 'Sad',
                        month: "Dec.",
                        day: "05"
                    },
                    {
                        contact: 'Third: Learn JavaScript\nWWW',
                        date: '2009-09-09',
                        user: 'Sad',
                        month: "Dec.",
                        day: "05"
                    }
                ]
            }
        })
    </script>

    <script>
        var ctx2 = document.getElementById("myChart2").getContext('2d');
        var myChart2 = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
                datasets: [{
                    label: '# of Votes',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });
    </script>
    <script>
        var h = document.documentElement,
            b = document.body,
            st = 'scrollTop',
            sh = 'scrollHeight';
        var progressbar = document.getElementById("progressbar");
        var pos = ((h[sh] || b[sh]) <= h.clientHeight) ? 100 : getVerticalScrollPercentage(b);
        progressbar.innerHTML = Math.round(pos) + '%';
        progressbar.style.width = Math.max(Math.round(pos), 10) + '%';
        document.getElementById("touchBar").addEventListener("mousedown",
            function clicked(e) {
                var br = document.getElementById("touchBar").getBoundingClientRect();
                // x & y are relative to the clicked element
                var x = e.clientX - br.left;
                var level = Math.round(x / document.getElementById("touchBar").offsetWidth * 100) / 100;

                window.scrollTo({
                    top: level * ((h[sh] || b[sh]) - h.clientHeight),
                    behavior: 'smooth'
                });

            });

        document.onscroll = function () {
            pos = getVerticalScrollPercentage(b)
            //aria-valuenow
            progressbar.innerHTML = Math.round(pos) + '%';
            progressbar.style.width = Math.max(Math.round(pos), 10) + '%';
        };

        function getVerticalScrollPercentage(elm) {

            //   console.log((h[st] || b[st]), (h[sh] || b[sh]), h.clientHeight)
            var percent = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;

            return percent
        }
    </script>
</body>

</html>